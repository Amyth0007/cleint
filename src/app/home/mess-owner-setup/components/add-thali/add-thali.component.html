<form [formGroup]="thaliForm" (ngSubmit)="confirmSave()" class="add-thali-form">
  <h2 class="thali-form-heading">{{ thaliData ? 'Edit Thali' : 'Add Today\'s Thali' }}</h2>

  <!-- Thali Name -->
  <div class="form-control-group">
    <div class="input-row">
      <label for="thaliName">Thali Name: <span class="required">*</span></label>
      <input type="text" formControlName="thaliName" id="thaliName" [readonly]="readonly && !isEditing" />
    </div>
    <div class="error" *ngIf="thaliForm.get('thaliName')?.touched && thaliForm.get('thaliName')?.invalid">
      Thali name is required.
    </div>
  </div>

  <!-- Rotis -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Number of Rotis: <span class="required">*</span></label>
      <input type="number" formControlName="rotis" min="0" [readonly]="readonly && !isEditing" />
    </div>
    <div class="error" *ngIf="thaliForm.get('rotis')?.touched && thaliForm.get('rotis')?.invalid">
      Number of rotis is required.
    </div>
  </div>

  <!-- Sabzi -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Sabzi: <span class="required">*</span></label>
      <input type="text" formControlName="sabzi" [readonly]="readonly && !isEditing" />
    </div>
    <div class="error" *ngIf="thaliForm.get('sabzi')?.touched && thaliForm.get('sabzi')?.invalid">
      Sabzi is required.
    </div>
  </div>

  <!-- Daal -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Daal: <span class="required">*</span></label>
      <div class="checkbox-group">
        <label><input type="radio" formControlName="daal" value="yes" [disabled]="readonly && !isEditing" /> Yes</label>
        <label><input type="radio" formControlName="daal" value="no" [disabled]="readonly && !isEditing" /> No</label>
      </div>
    </div>
    <div class="error" *ngIf="thaliForm.get('daal')?.touched && thaliForm.get('daal')?.invalid">
      Daal selection is required.
    </div>
    <div class="input-row" *ngIf="thaliForm.get('daal')?.value === 'no'">
      <label>Daal Replacement:</label>
      <input type="text" formControlName="daalReplacement" placeholder="Daal Replacement"
        [readonly]="readonly && !isEditing" />
    </div>
  </div>

  <!-- Rice -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Rice: <span class="required">*</span></label>
      <div class="checkbox-group">
        <label><input type="radio" formControlName="rice" value="yes" [disabled]="readonly && !isEditing" /> Yes</label>
        <label><input type="radio" formControlName="rice" value="no" [disabled]="readonly && !isEditing" /> No</label>
      </div>
    </div>
    <div class="error" *ngIf="thaliForm.get('rice')?.touched && thaliForm.get('rice')?.invalid">
      Rice selection is required.
    </div>
  </div>

  <!-- Salad -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Salad:</label>
      <div class="checkbox-group">
        <label><input type="radio" formControlName="salad" value="yes" [disabled]="readonly && !isEditing" />
          Yes</label>
        <label><input type="radio" formControlName="salad" value="no" [disabled]="readonly && !isEditing" /> No</label>
      </div>
    </div>
  </div>

  <!-- Sweet -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Sweet:</label>
      <div class="checkbox-group">
        <label><input type="radio" formControlName="sweet" value="yes" [disabled]="readonly && !isEditing" />
          Yes</label>
        <label><input type="radio" formControlName="sweet" value="no" [disabled]="readonly && !isEditing" /> No</label>
      </div>
    </div>
    <div class="input-row" *ngIf="thaliForm.get('sweet')?.value === 'yes'">
      <label>Sweet Info:</label>
      <input type="text" formControlName="sweetInfo" placeholder="Sweet Description"
        [readonly]="readonly && !isEditing" />
    </div>
  </div>

  <!-- Other Items -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Other Items:</label>
      <input type="text" formControlName="otherItems" [readonly]="readonly && !isEditing" />
    </div>
  </div>

  <!-- Thali Type -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Thali Type: <span class="required">*</span></label>
      <div class="checkbox-group">
        <label *ngFor="let type of thaliTypes">
          <input type="radio" formControlName="type" [value]="type" [disabled]="readonly && !isEditing" />
          {{ type | titlecase }}
        </label>
      </div>
    </div>
    <div class="error" *ngIf="thaliForm.get('type')?.touched && thaliForm.get('type')?.invalid">
      Thali type is required.
    </div>
  </div>

  <!-- Available From -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Available From: <span class="required">*</span></label>
      <input type="time" formControlName="availableFrom" [min]="timeMin" [max]="timeMax"
        [readonly]="readonly && !isEditing" />
    </div>
    <div class="error" *ngIf="thaliForm.get('availableFrom')?.touched && thaliForm.get('availableFrom')?.invalid">
      Available from time is required.
    </div>
  </div>

  <!-- Available Until -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Available Until: <span class="required">*</span></label>
      <input type="time" formControlName="availableUntil" [min]="timeMin" [max]="timeMax"
        [readonly]="readonly && !isEditing" />
    </div>
    <div class="error" *ngIf="thaliForm.get('availableUntil')?.touched && thaliForm.get('availableUntil')?.invalid">
      Available until time is required.
    </div>
  </div>

  <!-- Time Range Errors -->
  <div class="error" *ngIf="thaliForm.errors?.['invalidLunchTime']">
    Lunch time must be between 12:00 PM and 4:00 PM.
  </div>
  <div class="error" *ngIf="thaliForm.errors?.['invalidDinnerTime']">
    Dinner time must be between 7:00 PM and 11:00 PM.
  </div>

  <!-- Price -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Price (₹): <span class="required">*</span></label>
      <input type="number" formControlName="price" [readonly]="readonly && !isEditing" />
    </div>
    <div class="error" *ngIf="thaliForm.get('price')?.touched && thaliForm.get('price')?.invalid">
      Price is required and must be at least ₹1.
    </div>
  </div>

  <!-- Thali Image -->
  <div class="form-control-group">
    <div class="input-row">
      <label>Thali Image: <span class="required">*</span></label>
      <div class="upload-container"
        [class.has-error]="thaliForm.get('image')?.touched && thaliForm.get('image')?.invalid">
        <!-- Upload Box -->
        <div class="upload-prompt" *ngIf="!previewUrl && (!readonly || isEditing)" (click)="fileInput.click()">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#007BFF" viewBox="0 0 24 24">
              <path stroke="#007BFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                d="M19 18H6a4 4 0 0 1 0-8 5.5 5.5 0 0 1 10.58-1.36A4.5 4.5 0 0 1 19 18Zm-7-8v5m0 0 2-2m-2 2-2-2" />
            </svg>
          </div>
          <p>Drag & drop or <span class="highlight">browse</span></p>
          <small>Max 10MB</small>
        </div>

        <!-- Preview -->
        <div class="image-preview" *ngIf="previewUrl">
          <img [src]="previewUrl" alt="Thali preview" />
          <button type="button" class="remove-btn" (click)="removeImage()" *ngIf="!readonly || isEditing">✕</button>
        </div>

        <input type="file" #fileInput accept="image/*" hidden formControlName="image" (change)="onFileSelected($event)"
          [disabled]="readonly && !isEditing" />
      </div>
    </div>
    <div class="error" *ngIf="thaliForm.get('image')?.touched && thaliForm.get('image')?.invalid">
      Thali image is required.
    </div>
  </div>
  <!-- Form Actions -->
  <div class="form-row center">
    <!-- Create mode (new thali) -->
    <button type="submit" class="save-btn" *ngIf="!thaliData">Save Thali</button>

    <!-- Edit mode -->
    <ng-container *ngIf="thaliData">
      <button type="submit" class="save-btn" *ngIf="isEditing">Save</button>
      <button type="button" class="cancel-btn" (click)="confirmCancel()" *ngIf="isEditing">Cancel</button>
    </ng-container>
  </div>
</form>

<app-confirm-dialog 
  *ngIf="showDialog"
  [title]="dialogTitle"
  [message]="dialogMessage"
  [confirmText]="dialogConfirmText"
  [cancelText]="dialogCancelText"
  [colorScheme]="dialogColor"
  (confirm)="onDialogConfirm()"
  (cancel)="onDialogCancel()">
</app-confirm-dialog>
